---
layout: post
title: Django, Apache 2 and mod_wsgi
date: '2011-09-29T15:01:00.000-07:00'
author: Mark Evans
tags:
- Apache
- python
- mod_wsgi
- Django
modified_time: '2011-10-05T14:34:24.901-07:00'
blogger_id: tag:blogger.com,1999:blog-8042776731714569314.post-4546778817000695901
blogger_orig_url: http://codexpython.blogspot.com/2011/09/django-apache-2-and-modwsgi.html
---

A pain in the neck to set up, but nice to have.<br /><br />1. Follow installation instructions for mod_wsgi and django<br />2. Add to httpd.conf<br /><br /><span class="Apple-style-span" style="background-color: white; font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; <b># ----------- Django / WSGI Configuration ----------</b></span><br /><b><span class="Apple-style-span" style="background-color: white; font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp;WSGIDaemonProcess processes=2 threads=15</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp;</span></b><br /><b><span class="Apple-style-span" style="background-color: white; font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp;WSGIScriptAlias /mgrm "/home/django/var/www/mgrm/apache/django.wsgi"</span></b><br /><b><span class="Apple-style-span" style="background-color: white; font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp;&lt;Directory "/home/django/var/www/mgrm/"&gt;</span></b><br /><b><span class="Apple-style-span" style="background-color: white; font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Order allow,deny</span></b><br /><b><span class="Apple-style-span" style="background-color: white; font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow from all</span></b><br /><b><span class="Apple-style-span" style="background-color: white; font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &lt;/Directory&gt;</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp;</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; Alias "/static/admin" "/opt/python2.7/lib/python2.7/site-packages/django/contrib/admin/media/"</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &lt;Directory "/opt/python2.7/lib/python2.7/site-packages/django/contrib/admin/media/"&gt;</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Order allow,deny</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Allow from all</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &lt;/Directory&gt;</span></b><br /><div><br /></div><br />*Note that the alias for "static/admin" must match whatever alias and path are in the main settings.py file in your Django project directory<br /><br />3. Create a django.wsgi file in the place that is specified by the path you used in the WSGIScriptAlias that contains the following:<br /><br /><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">import os</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">import sys</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"># Option one</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">#sys.path.append('/home/django/var/www')</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">#sys.path.append('/home/django/var/www/mgrm')</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">#os.environ['DJANGO_SETTINGS_MODULE'] = 'mgrm.settings'</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">#os.environ['DJANGO_ENV'] = 'PRODUCTION'</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"># Option two</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"># from http://blog.dscpl.com.au/2010/03/improved-wsgi-script-for-use-with.html</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">sys.path.insert(0,'/home/django/var/www/mgrm')</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">import settings</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">import django.core.management</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">django.core.management.setup_environ(settings)</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">utility = django.core.management.ManagementUtility()</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">command = utility.fetch_command('runserver')</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">command.validate()</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">import django.conf</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">import django.utils</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">django.utils.translation.activate(django.conf.settings.LANGUAGE_CODE)</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"># Common to both options</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">import django.core.handlers.wsgi</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">application = django.core.handlers.wsgi.WSGIHandler()</span></b><br /><br /><br />*Note that this file goes inside your django project folder, preferably in an apache folder.<br /><br />5. Edit main urls.py so that you can use files with both the django server and apache like this:<br /><br /><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">urlpatterns = patterns('',</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; # mod_wsgi does NOT pass the '/mgrm' mount point to this application. However,</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; # &nbsp; the django development server does. So in order to get these urls.py to</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; # &nbsp; work correctly with both, I created a match group that doesn't create a&nbsp;</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; # &nbsp; back reference. That match group is this: (?:mgrm/)?</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; url(r'^(?:mgrm/)?polls/',include('polls.urls')),</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp;&nbsp;</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; # Admin sites are doing some reverse url lookup, and the match group trick</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; # &nbsp; doesn't work with them. &nbsp;To resolve this issue we create two references:</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; # &nbsp; one for mod_wsgi, and the other for the development server.</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; url(r'^admin/',include(admin.site.urls)),</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; url(r'^mgrm/admin/', include(admin.site.urls)),</span></b><br /><b><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">)</span></b><br /><br /><br />6. May need to edit templates to add the application name to each url in the template.